<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Brightfield TFM &amp; Cropped Input" href="6_BrightfieldTFM.html" /><link rel="prev" title="Microbeads to Detect Matrix Deformations" href="3_BeadMeasurement.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2024.08.06 -->
        <title>Multicellular TFM (intestinal organoids) - saenopy 1.0.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=04c057b233f3c8d71940eee6080f658a04e2027d" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=cf727022eb7470bc603c08d2e55c3247faec75c9" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">saenopy 1.0.6 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">saenopy 1.0.6 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../interface.html">Interface</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Interface</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interface_solver.html">Interface Solver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../boundarycondition.html">Boundary Condition Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regularization.html">Regularization Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mesh.html">Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../material.html">Material</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_SingleCellTFM.html">Classic TFM (liver fibroblasts)</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_DynamicalSingleCellTFM.html">Dynamic TFM (immune cells)</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_BeadMeasurement.html">Microbeads to Detect Matrix Deformations</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Multicellular TFM (intestinal organoids)</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_BrightfieldTFM.html">Brightfield TFM &amp; Cropped Input</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ReadInData.html">Read Files with Pyhton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/auto_examples/4_OrganoidTFM.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-4-organoidtfm-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="multicellular-tfm-intestinal-organoids">
<span id="sphx-glr-auto-examples-4-organoidtfm-py"></span><h1>Multicellular TFM (intestinal organoids)<a class="headerlink" href="#multicellular-tfm-intestinal-organoids" title="Permalink to this heading">¶</a></h1>
<p>This example evaluates contractile forces of an individual intestinal organoid embedded in 1.2mg/ml collagen imaged with confocal reflection microscopy.
The relaxed stacks were recorded after Triton x-100 treatment. We evaluate the contraction between ~23h in collagen compared
to the state after drug relaxation (indicated at the end of the video). This example can also be evaluated with the graphical user interface.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../_images/Gif_organoid.gif"><img alt="../_images/Gif_organoid.gif" src="../_images/Gif_organoid.gif" style="width: 512.0px; height: 384.0px;" /></a>
</figure>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span> <span class="kn">import</span><span class="w"> </span><span class="nn">saenopy</span>
</pre></div>
</div>
<section id="downloading-the-example-data-files">
<h2>Downloading the example data files<a class="headerlink" href="#downloading-the-example-data-files" title="Permalink to this heading">¶</a></h2>
<p>An individual intestinal organoid is recorded at one positions (Pos07) in collagen 1.2 mg/ml.
Images are recorded in confocal reflection channel (ch00) after ~23h in collagen (t50) and after drug relaxation
approx. 2 hours later (t6).
The lower time index t6 is due of the start of a new image series and refers to the image AFTER relaxation.
The stack has 52 z positions (z00-z51). T</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>4_OrganoidTFM
├── Pos007_S001_t50_z00_ch00.tif
├── Pos007_S001_t50_z01_ch00.tif
├── Pos007_S001_t50_z02_ch00.tif
├── ...
├── Pos007_S001_t6_z00_ch00.tif
├── Pos007_S001_t6_z01_ch00.tif
├── Pos007_S001_t6_z02_ch00.tif
└── ...
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">42</span> <span class="c1"># download the data</span>
<span class="linenos">43</span> <span class="n">saenopy</span><span class="o">.</span><span class="n">load_example</span><span class="p">(</span><span class="s2">&quot;OrganoidTFM&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="loading-the-stacks">
<h2>Loading the Stacks<a class="headerlink" href="#loading-the-stacks" title="Permalink to this heading">¶</a></h2>
<p>Saenopy is very flexible in loading stacks from any filename structure.
Here we do not have multiple positions, so we do not need to use and asterisk * for batch processing.
We do not have multiple channels, so we do not need a channel placeholder.
We replace the number of the z slice “z00” with a z placeholder “z{z}” to indicate that this number refers to the
z slice. We do the same for the deformed state and for the reference stack.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">55</span> <span class="c1"># load the relaxed and the contracted stack</span>
<span class="linenos">56</span> <span class="c1"># {z} is the placeholder for the z stack</span>
<span class="linenos">57</span> <span class="c1"># {c} is the placeholder for the channels</span>
<span class="linenos">58</span> <span class="c1"># {t} is the placeholder for the time points</span>
<span class="linenos">59</span> <span class="n">results</span> <span class="o">=</span> <span class="n">saenopy</span><span class="o">.</span><span class="n">get_stacks</span><span class="p">(</span>
<span class="linenos">60</span>     <span class="s1">&#39;4_OrganoidTFM/Pos007_S001_t50_z</span><span class="si">{z}</span><span class="s1">_ch00.tif&#39;</span><span class="p">,</span>
<span class="linenos">61</span>     <span class="n">reference_stack</span><span class="o">=</span><span class="s1">&#39;4_OrganoidTFM/Pos007_S001_t6_z</span><span class="si">{z}</span><span class="s1">_ch00.tif&#39;</span><span class="p">,</span>
<span class="linenos">62</span>     <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;4_OrganoidTFM/example_output&#39;</span><span class="p">,</span>
<span class="linenos">63</span>     <span class="n">voxel_size</span><span class="o">=</span><span class="p">[</span><span class="mf">1.444</span><span class="p">,</span> <span class="mf">1.444</span><span class="p">,</span> <span class="mf">1.976</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="detecting-the-deformations">
<h2>Detecting the Deformations<a class="headerlink" href="#detecting-the-deformations" title="Permalink to this heading">¶</a></h2>
<p>Saenopy uses 3D Particle Image Velocimetry (PIV) with the following parameters
to calculate matrix deformations between the deformed and relaxed state.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Piv Parameter</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>element_size</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>window_size</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-even"><td><p>signal_to_noise</p></td>
<td><p>1.3</p></td>
</tr>
<tr class="row-odd"><td><p>drift_correction</p></td>
<td><p>True</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 85</span> <span class="c1"># define the parameters for the piv deformation detection</span>
<span class="linenos"> 86</span> <span class="n">piv_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;element_size&#39;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span> <span class="s1">&#39;window_size&#39;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span> <span class="s1">&#39;signal_to_noise&#39;</span><span class="p">:</span> <span class="mf">1.3</span><span class="p">,</span> <span class="s1">&#39;drift_correction&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span> <span class="c1"># iterate over all the results objects</span>
<span class="linenos"> 90</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<span class="linenos"> 91</span>     <span class="c1"># set the parameters</span>
<span class="linenos"> 92</span>     <span class="n">result</span><span class="o">.</span><span class="n">piv_parameters</span> <span class="o">=</span> <span class="n">piv_parameters</span>
<span class="linenos"> 93</span>     <span class="c1"># get count</span>
<span class="linenos"> 94</span>     <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stacks</span><span class="p">)</span>
<span class="linenos"> 95</span>     <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">stack_reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 96</span>         <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos"> 97</span>     <span class="c1"># iterate over all stack pairs</span>
<span class="linenos"> 98</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
<span class="linenos"> 99</span>         <span class="c1"># get two consecutive stacks</span>
<span class="linenos">100</span>         <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">stack_reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">101</span>             <span class="n">stack1</span><span class="p">,</span> <span class="n">stack2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stacks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">stacks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="linenos">102</span>         <span class="c1"># or reference stack and one from the list</span>
<span class="linenos">103</span>         <span class="k">else</span><span class="p">:</span>
<span class="linenos">104</span>             <span class="n">stack1</span><span class="p">,</span> <span class="n">stack2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stack_reference</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">stacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="linenos">105</span>         <span class="c1"># and calculate the displacement between them</span>
<span class="linenos">106</span>         <span class="n">result</span><span class="o">.</span><span class="n">mesh_piv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">saenopy</span><span class="o">.</span><span class="n">get_displacements_from_stacks</span><span class="p">(</span><span class="n">stack1</span><span class="p">,</span> <span class="n">stack2</span><span class="p">,</span>
<span class="linenos">107</span>                                                                    <span class="n">piv_parameters</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">],</span>
<span class="linenos">108</span>                                                                    <span class="n">piv_parameters</span><span class="p">[</span><span class="s2">&quot;element_size&quot;</span><span class="p">],</span>
<span class="linenos">109</span>                                                                    <span class="n">piv_parameters</span><span class="p">[</span><span class="s2">&quot;signal_to_noise&quot;</span><span class="p">],</span>
<span class="linenos">110</span>                                                                    <span class="n">piv_parameters</span><span class="p">[</span><span class="s2">&quot;drift_correction&quot;</span><span class="p">])</span>
<span class="linenos">111</span>     <span class="c1"># save the displacements</span>
<span class="linenos">112</span>     <span class="n">result</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="generating-the-finite-element-mesh">
<h2>Generating the Finite Element Mesh<a class="headerlink" href="#generating-the-finite-element-mesh" title="Permalink to this heading">¶</a></h2>
<p>Interpolate the found deformations onto a new mesh which will be used for the regularisation.
In this case, we are experimental limited (due to the size, strength and spatial expansion of the organoid and our objective) and can not image the
complete matrix deformation field around the organoid. To obtain higher accuracy for a cropped deformation field,
we perform the force reconstruction in a volume with increased z-height.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Mesh Parameter</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>element_size</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>mesh_size</p></td>
<td><p>(738, 738, 738)</p></td>
</tr>
<tr class="row-even"><td><p>reference_stack</p></td>
<td><p>‘first’</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">133</span> <span class="c1"># define the parameters to generate the solver mesh and interpolate the piv mesh onto it</span>
<span class="linenos">134</span> <span class="n">mesh_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;reference_stack&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;element_size&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;mesh_size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">738</span><span class="p">,</span> <span class="mi">738</span><span class="p">,</span> <span class="mi">738</span><span class="p">)}</span>
<span class="linenos">135</span>
<span class="linenos">136</span> <span class="c1"># iterate over all the results objects</span>
<span class="linenos">137</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<span class="linenos">138</span>     <span class="c1"># correct for the reference state</span>
<span class="linenos">139</span>     <span class="n">displacement_list</span> <span class="o">=</span> <span class="n">saenopy</span><span class="o">.</span><span class="n">subtract_reference_state</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">mesh_piv</span><span class="p">,</span> <span class="n">mesh_parameters</span><span class="p">[</span><span class="s2">&quot;reference_stack&quot;</span><span class="p">])</span>
<span class="linenos">140</span>     <span class="c1"># set the parameters</span>
<span class="linenos">141</span>     <span class="n">result</span><span class="o">.</span><span class="n">mesh_parameters</span> <span class="o">=</span> <span class="n">mesh_parameters</span>
<span class="linenos">142</span>     <span class="c1"># iterate over all stack pairs</span>
<span class="linenos">143</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">mesh_piv</span><span class="p">)):</span>
<span class="linenos">144</span>         <span class="c1"># and create the interpolated solver mesh</span>
<span class="linenos">145</span>         <span class="n">result</span><span class="o">.</span><span class="n">solvers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">saenopy</span><span class="o">.</span><span class="n">interpolate_mesh</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">mesh_piv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">displacement_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mesh_parameters</span><span class="p">)</span>
<span class="linenos">146</span>     <span class="c1"># save the meshes</span>
<span class="linenos">147</span>     <span class="n">result</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="calculating-the-forces">
<h2>Calculating the Forces<a class="headerlink" href="#calculating-the-forces" title="Permalink to this heading">¶</a></h2>
<p>Define the material model and run the regularisation to fit the measured deformations and get the forces. Here we define a low convergence criterion
and let the algorithm run for the maximal amount of steps that we define to 1400. Afterwards, we can check the regularisation_results in the console or
in the graphical user interface.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Material Parameter</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>k</p></td>
<td><p>6062</p></td>
</tr>
<tr class="row-odd"><td><p>d_0</p></td>
<td><p>0.0025</p></td>
</tr>
<tr class="row-even"><td><p>lambda_s</p></td>
<td><p>0.0804</p></td>
</tr>
<tr class="row-odd"><td><p>d_s</p></td>
<td><p>0.034</p></td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Regularisation Parameter</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>alpha</p></td>
<td><p>10**10</p></td>
</tr>
<tr class="row-odd"><td><p>step_size</p></td>
<td><p>0.33</p></td>
</tr>
<tr class="row-even"><td><p>max_iterations</p></td>
<td><p>1400</p></td>
</tr>
<tr class="row-odd"><td><p>rel_conv_crit</p></td>
<td><p>1e-7</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">181</span> <span class="c1"># define the parameters to generate the solver mesh and interpolate the piv mesh onto it</span>
<span class="linenos">182</span> <span class="n">material_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="mf">6062.0</span><span class="p">,</span> <span class="s1">&#39;d_0&#39;</span><span class="p">:</span> <span class="mf">0.0025</span><span class="p">,</span> <span class="s1">&#39;lambda_s&#39;</span><span class="p">:</span> <span class="mf">0.0804</span><span class="p">,</span> <span class="s1">&#39;d_s&#39;</span><span class="p">:</span>  <span class="mf">0.034</span><span class="p">}</span>
<span class="linenos">183</span> <span class="n">solve_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;step_size&#39;</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span> <span class="s1">&#39;max_iterations&#39;</span><span class="p">:</span> <span class="mi">1400</span><span class="p">,</span> <span class="s1">&#39;rel_conv_crit&#39;</span><span class="p">:</span> <span class="mf">1e-7</span><span class="p">}</span>
<span class="linenos">184</span>
<span class="linenos">185</span> <span class="c1"># iterate over all the results objects</span>
<span class="linenos">186</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<span class="linenos">187</span>     <span class="n">result</span><span class="o">.</span><span class="n">material_parameters</span> <span class="o">=</span> <span class="n">material_parameters</span>
<span class="linenos">188</span>     <span class="n">result</span><span class="o">.</span><span class="n">solve_parameters</span> <span class="o">=</span> <span class="n">solve_parameters</span>
<span class="linenos">189</span>     <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">solvers</span><span class="p">:</span>
<span class="linenos">190</span>         <span class="c1"># set the material model</span>
<span class="linenos">191</span>         <span class="n">M</span><span class="o">.</span><span class="n">set_material_model</span><span class="p">(</span><span class="n">saenopy</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">SemiAffineFiberMaterial</span><span class="p">(</span>
<span class="linenos">192</span>             <span class="n">material_parameters</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">],</span>
<span class="linenos">193</span>             <span class="n">material_parameters</span><span class="p">[</span><span class="s2">&quot;d_0&quot;</span><span class="p">],</span>
<span class="linenos">194</span>             <span class="n">material_parameters</span><span class="p">[</span><span class="s2">&quot;lambda_s&quot;</span><span class="p">],</span>
<span class="linenos">195</span>             <span class="n">material_parameters</span><span class="p">[</span><span class="s2">&quot;d_s&quot;</span><span class="p">],</span>
<span class="linenos">196</span>         <span class="p">))</span>
<span class="linenos">197</span>         <span class="c1"># find the regularized force solution</span>
<span class="linenos">198</span>         <span class="n">M</span><span class="o">.</span><span class="n">solve_regularized</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">solve_parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span> <span class="n">step_size</span><span class="o">=</span><span class="n">solve_parameters</span><span class="p">[</span><span class="s2">&quot;step_size&quot;</span><span class="p">],</span>
<span class="linenos">199</span>                             <span class="n">max_iterations</span><span class="o">=</span><span class="n">solve_parameters</span><span class="p">[</span><span class="s2">&quot;max_iterations&quot;</span><span class="p">],</span>
<span class="linenos">200</span>                             <span class="n">rel_conv_crit</span><span class="o">=</span><span class="n">solve_parameters</span><span class="p">[</span><span class="s2">&quot;rel_conv_crit&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">201</span>     <span class="c1"># save the forces</span>
<span class="linenos">202</span>     <span class="n">result</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="display-results">
<h2>Display Results<a class="headerlink" href="#display-results" title="Permalink to this heading">¶</a></h2>
<p>ToDo</p>
<p>The reconstructed force field (right) generates a reconstructed deformation field (middle)
that recapitulates the measured matrix deformation field (left). The overall cell contractility is
calculated as all forcecomponents pointing to the force epicenter.</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-4-organoidtfm-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/93dbdd3bb07f888ea5cabeca2fa340ae/4_OrganoidTFM.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">4_OrganoidTFM.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/c959132d1263bf2f5eadab2fb0e467bd/4_OrganoidTFM.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">4_OrganoidTFM.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="6_BrightfieldTFM.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Brightfield TFM &amp; Cropped Input</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="3_BeadMeasurement.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Microbeads to Detect Matrix Deformations</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-2023, Richard Gerum, David Böhringer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Multicellular TFM (intestinal organoids)</a><ul>
<li><a class="reference internal" href="#downloading-the-example-data-files">Downloading the example data files</a></li>
<li><a class="reference internal" href="#loading-the-stacks">Loading the Stacks</a></li>
<li><a class="reference internal" href="#detecting-the-deformations">Detecting the Deformations</a></li>
<li><a class="reference internal" href="#generating-the-finite-element-mesh">Generating the Finite Element Mesh</a></li>
<li><a class="reference internal" href="#calculating-the-forces">Calculating the Forces</a></li>
<li><a class="reference internal" href="#display-results">Display Results</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>